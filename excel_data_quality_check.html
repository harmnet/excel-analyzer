<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelæ•°æ®é›†å¼‚å¸¸å€¼åˆ†æå·¥å…· - ç½‘é¡µç‰ˆ</title>
    <style>
        :root {
            --primary-color: rgb(158, 33, 65);
            --gold-color: rgb(177, 136, 101);
            --gray-color: rgb(166, 166, 166);
            --text-color: rgb(60, 60, 60);
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: var(--text-color);
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        h2 {
            color: var(--gold-color);
            font-weight: normal;
            margin-top: 0;
        }
        
        .divider {
            height: 1px;
            background-color: var(--gray-color);
            margin: 20px 0;
        }
        
        .section {
            border: 1px solid #d0d0d0;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .file-selection {
            display: flex;
            align-items: center;
        }
        
        .file-path {
            flex: 1;
            padding: 8px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            margin-right: 10px;
            background-color: #f9f9f9;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: rgb(178, 53, 85);
        }
        
        button:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }
        
        #analyzeBtn {
            font-size: 16px;
            font-weight: bold;
            padding: 12px 20px;
            margin: 10px 0;
            width: 100%;
        }
        
        select {
            padding: 8px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            width: 100%;
            background-color: white;
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 24px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--gold-color);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #d0d0d0;
            margin-bottom: 15px;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid #d0d0d0;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f0f0f0;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #d0d0d0;
            border-top: none;
            border-radius: 0 0 4px 4px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            background-color: white;
        }
        
        .tab-content.active {
            display: block;
        }
        
        #progressLog {
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        #resultText {
            white-space: pre-wrap;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.5;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-color);
            font-size: 12px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        table, th, td {
            border: 1px solid #d0d0d0;
        }
        
        th, td {
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
        }
        
        .expanded-result-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .dialog-content {
            background-color: white;
            border-radius: 8px;
            width: 80%;
            height: 80%;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .dialog-body {
            flex: 1;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
        }
        
        .dialog-close {
            align-self: flex-end;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Excelæ•°æ®é›†å¼‚å¸¸å€¼åˆ†æå·¥å…·</h1>
            <h2>ä½¿ç”¨å¤§æ¨¡å‹åˆ†æExcelæ•°æ®é›†ä¸­çš„å¼‚å¸¸å€¼</h2>
        </header>
        
        <div class="divider"></div>
        
        <div class="section">
            <div class="section-title">é€‰æ‹©Excelæ–‡ä»¶</div>
            <div class="file-selection">
                <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
                <div id="filePath" class="file-path">è¯·é€‰æ‹©è¦åˆ†æçš„Excelæ–‡ä»¶...</div>
                <button id="browseBtn">æµè§ˆ...</button>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">åˆ†æå‚æ•°è®¾ç½®</div>
            <div>
                <label for="modelSelect">ä½¿ç”¨æ¨¡å‹:</label>
                <select id="modelSelect">
                    <option value="qwen">ğŸ” åƒé—®QwQ-32B</option>
                    <option value="deepseek" selected>ğŸ” DeepSeek-R1</option>
                    <option value="moonshot">ğŸŒ™ Moonshot AI</option>
                </select>
            </div>
            
            <div style="margin-top: 20px;">
                <button id="analyzeBtn" disabled>AIä¸€é”®åˆ†æ</button>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
                <div id="progressText" class="progress-text">0%</div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="progressTab">å¤„ç†æ—¥å¿—</div>
            <div class="tab" data-tab="resultTab">åˆ†æç»“æœ</div>
        </div>
        
        <div id="progressTab" class="tab-content active">
            <div id="progressLog"></div>
        </div>
        
        <div id="resultTab" class="tab-content">
            <div id="resultText"></div>
            <button id="expandBtn" style="margin-top: 10px;">å±•å¼€æŸ¥çœ‹å®Œæ•´ç»“æœ</button>
        </div>
        
        <div class="footer">
            <p>æœ¬å·¥å…·åŸºäºæµè§ˆå™¨çš„Excelè§£æåŠŸèƒ½ï¼Œæ‰€æœ‰åˆ†æåœ¨æœ¬åœ°å®Œæˆï¼Œä¸ä¼šä¸Šä¼ æ‚¨çš„Excelæ–‡ä»¶</p>
            <p>Â© 2024 Excelæ•°æ®è´¨é‡æ£€æŸ¥å·¥å…· - ç½‘é¡µç‰ˆ</p>
        </div>
    </div>
    
    <div id="expandedResultDialog" class="expanded-result-dialog">
        <div class="dialog-content">
            <div class="dialog-body" id="expandedResultText"></div>
            <button class="dialog-close" id="dialogCloseBtn">å…³é—­</button>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // DOM å…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const filePath = document.getElementById('filePath');
        const browseBtn = document.getElementById('browseBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressLog = document.getElementById('progressLog');
        const resultText = document.getElementById('resultText');
        const expandBtn = document.getElementById('expandBtn');
        const expandedResultDialog = document.getElementById('expandedResultDialog');
        const expandedResultText = document.getElementById('expandedResultText');
        const dialogCloseBtn = document.getElementById('dialogCloseBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // å…¨å±€å˜é‡
        let excelData = null;
        let fileName = '';
        let analyzing = false;
        let abortController = null;

        // äº‹ä»¶ç›‘å¬
        browseBtn.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileName = file.name;
                filePath.textContent = fileName;
                readExcelFile(file);
            }
        });

        analyzeBtn.addEventListener('click', startAnalysis);

        expandBtn.addEventListener('click', () => {
            expandedResultText.innerHTML = resultText.innerHTML;
            expandedResultDialog.style.display = 'flex';
        });

        dialogCloseBtn.addEventListener('click', () => {
            expandedResultDialog.style.display = 'none';
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°é€‰ä¸­çš„æ ‡ç­¾
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // å‡½æ•°
        function readExcelFile(file) {
            const reader = new FileReader();
            
            logProgress('æ­£åœ¨è¯»å–Excelæ–‡ä»¶...');
            updateProgress(10);
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½¬æ¢ä¸ºJSON
                    excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // æ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                    if (excelData && excelData.length > 1) {
                        logProgress(`æˆåŠŸè¯»å–Excelæ–‡ä»¶ï¼Œå…±æœ‰ ${excelData.length - 1} è¡Œï¼Œ${excelData[0].length} åˆ—`);
                        
                        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                        logProgress('\næ•°æ®é¢„è§ˆ (å‰5è¡Œ):');
                        const previewRows = Math.min(5, excelData.length);
                        for (let i = 0; i < previewRows; i++) {
                            logProgress(excelData[i].join('\t'));
                        }
                        
                        // å¯ç”¨åˆ†ææŒ‰é’®
                        analyzeBtn.disabled = false;
                        updateProgress(20);
                    } else {
                        logProgress('é”™è¯¯ï¼šExcelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                        analyzeBtn.disabled = true;
                    }
                } catch (error) {
                    logProgress(`è¯»å–Excelæ–‡ä»¶å‡ºé”™: ${error.message}`);
                    analyzeBtn.disabled = true;
                }
            };
            
            reader.onerror = function() {
                logProgress('è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯');
                analyzeBtn.disabled = true;
            };
            
            reader.readAsArrayBuffer(file);
        }

        async function startAnalysis() {
            if (analyzing) return;
            analyzing = true;
            abortController = new AbortController();
            
            try {
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'åˆ†æä¸­...';
                resultText.innerHTML = '';
                
                logProgress('\nå¼€å§‹æ•°æ®åˆ†æ...');
                updateProgress(25);
                
                // å‡†å¤‡æ•°æ®ä¿¡æ¯
                const headers = excelData[0];
                const dataRows = excelData.slice(1);
                
                // åˆ›å»ºæ•°æ®ç±»å‹ä¿¡æ¯
                const dataTypes = headers.map(header => {
                    const columnIndex = headers.indexOf(header);
                    const columnValues = dataRows.map(row => row[columnIndex]).filter(val => val !== undefined);
                    const type = inferDataType(columnValues);
                    return { header, type };
                });
                
                const dataInfo = `æ•°æ®é›†ä¿¡æ¯ï¼š
- è¡Œæ•°ï¼š${dataRows.length}
- åˆ—æ•°ï¼š${headers.length}
- åˆ—åï¼š${headers.join(', ')}

æ•°æ®ç±»å‹ï¼š
${dataTypes.map(dt => `- ${dt.header}: ${dt.type}`).join('\n')}`;
                
                logProgress('\n' + dataInfo);
                updateProgress(30);
                
                // æ¨¡æ‹Ÿåˆ†æ‰¹å¤„ç†
                const batchSize = 100;
                const numBatches = Math.ceil(dataRows.length / batchSize);
                
                for (let i = 0; i < numBatches; i++) {
                    if (analyzing === false) break;
                    
                    const startIdx = i * batchSize;
                    const endIdx = Math.min((i + 1) * batchSize, dataRows.length);
                    
                    logProgress(`\nå¤„ç†æ•°æ®æ‰¹æ¬¡ ${i+1}/${numBatches} (è¡Œ ${startIdx+1} åˆ° ${endIdx})`);
                    
                    // æ›´æ–°è¿›åº¦æ¡
                    const progress = 30 + (i / numBatches) * 40;
                    updateProgress(progress);
                    
                    // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                if (analyzing) {
                    logProgress('\næ‰€æœ‰æ•°æ®æ‰¹æ¬¡å¤„ç†å®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆåˆ†æç»“æœ...');
                    updateProgress(75);
                    
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // ç”Ÿæˆæ¨¡æ‹Ÿåˆ†æç»“æœ
                    const analysisResult = generateMockAnalysis(headers, dataRows, dataTypes);
                    
                    // æ˜¾ç¤ºåˆ†æç»“æœ
                    resultText.innerHTML = analysisResult;
                    updateProgress(100);
                    
                    logProgress('\nåˆ†æå®Œæˆï¼è¯·æŸ¥çœ‹"åˆ†æç»“æœ"é€‰é¡¹å¡æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚');
                    
                    // è‡ªåŠ¨åˆ‡æ¢åˆ°ç»“æœæ ‡ç­¾
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    document.querySelector('[data-tab="resultTab"]').classList.add('active');
                    document.getElementById('resultTab').classList.add('active');
                } else {
                    logProgress('\nåˆ†æå·²è¢«ç”¨æˆ·å–æ¶ˆ');
                }
            } catch (error) {
                logProgress(`åˆ†æè¿‡ç¨‹ä¸­å‡ºé”™ï¼š${error.message}`);
                updateProgress(0);
            } finally {
                analyzing = false;
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'AIä¸€é”®åˆ†æ';
            }
        }

        function inferDataType(values) {
            if (values.length === 0) return 'ç©ºåˆ—';
            
            // æ£€æŸ¥æ•°å­—ç±»å‹
            const numericCount = values.filter(v => !isNaN(Number(v))).length;
            if (numericCount / values.length > 0.8) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ—¥æœŸæ ¼å¼
                const datePattern = /^\d{4}[-/]\d{1,2}[-/]\d{1,2}|^\d{1,2}[-/]\d{1,2}[-/]\d{4}/;
                const dateCount = values.filter(v => String(v).match(datePattern)).length;
                
                if (dateCount / values.length > 0.5) {
                    return 'datetime';
                }
                
                // åˆ¤æ–­æ˜¯æ•´æ•°è¿˜æ˜¯æµ®ç‚¹æ•°
                const floatCount = values.filter(v => String(v).includes('.')).length;
                if (floatCount / numericCount > 0.2) {
                    return 'float';
                }
                return 'int';
            }
            
            // é»˜è®¤å­—ç¬¦ä¸²ç±»å‹
            return 'object';
        }

        function generateMockAnalysis(headers, dataRows, dataTypes) {
            const modelName = document.getElementById('modelSelect').value;
            const modelDisplay = {
                'qwen': 'åƒé—®QwQ-32B',
                'deepseek': 'DeepSeek-R1',
                'moonshot': 'Moonshot AI'
            };
            
            // åˆ›å»ºåŸºæœ¬æè¿°
            let result = `# Excelæ•°æ®é›†å¼‚å¸¸å€¼åˆ†æç»“æœ

## åŸºæœ¬æƒ…å†µ

- **æ•°æ®é›†è¡Œæ•°**: ${dataRows.length}
- **æ•°æ®é›†åˆ—æ•°**: ${headers.length}
- **ä½¿ç”¨æ¨¡å‹**: ${modelDisplay[modelName]}

### æ•°æ®é›†åˆ—ä¿¡æ¯

| åˆ—å | æ•°æ®ç±»å‹ | éç©ºå€¼æ•°é‡ | å”¯ä¸€å€¼æ•°é‡ |
|------|----------|------------|------------|
`;

            // å¡«å……åˆ—ä¿¡æ¯è¡¨
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i];
                const columnIndex = i;
                const values = dataRows.map(row => row[columnIndex]);
                const nonNullCount = values.filter(v => v !== undefined && v !== null && v !== '').length;
                
                // è®¡ç®—å”¯ä¸€å€¼
                const uniqueValues = new Set(values);
                const uniqueCount = uniqueValues.size;
                
                result += `| ${header} | ${dataTypes[i].type} | ${nonNullCount} | ${uniqueCount} |\n`;
            }
            
            // æ¨¡æ‹Ÿå‘ç°çš„å¼‚å¸¸
            result += `\n## å¼‚å¸¸å€¼æ£€æµ‹ç»“æœ\n\n`;
            
            // éšæœºé€‰æ‹©ä¸€äº›åˆ—ç”Ÿæˆå¼‚å¸¸æè¿°
            const abnormalColumns = [];
            const abnormalCount = Math.min(2 + Math.floor(Math.random() * 3), headers.length);
            
            while (abnormalColumns.length < abnormalCount) {
                const idx = Math.floor(Math.random() * headers.length);
                if (!abnormalColumns.includes(idx)) {
                    abnormalColumns.push(idx);
                }
            }
            
            if (abnormalColumns.length > 0) {
                result += `å‘ç°ä»¥ä¸‹åˆ—å­˜åœ¨å¼‚å¸¸å€¼:\n\n`;
                result += `| å¼‚å¸¸å­—æ®µåç§° | å¼‚å¸¸å€¼æè¿° | é—®é¢˜åˆ†æ | å¤„ç†å»ºè®® |\n`;
                result += `|------------|-----------|---------|----------|\n`;
                
                for (const colIdx of abnormalColumns) {
                    const header = headers[colIdx];
                    const columnIndex = colIdx;
                    const values = dataRows.map(row => row[columnIndex]);
                    const dataType = dataTypes[colIdx].type;
                    
                    let abnormalDesc, analysis, suggestion;
                    
                    if (dataType === 'int' || dataType === 'float') {
                        abnormalDesc = 'å‘ç°æ•°å€¼å¼‚å¸¸ï¼ŒåŒ…å«æå¤§å€¼å’Œç©ºå€¼';
                        analysis = 'éƒ¨åˆ†æ•°å€¼å¯èƒ½æ˜¯é”™è¯¯è¾“å…¥æˆ–ç³»ç»Ÿé»˜è®¤å€¼ï¼Œä¸å…¶ä»–æ•°æ®ç›¸å·®è¿‡å¤§';
                        suggestion = 'å¯¹è¶…å‡º3ä¸ªæ ‡å‡†å·®çš„å€¼è¿›è¡Œæ£€æŸ¥ï¼Œè€ƒè™‘ç”¨å‡å€¼æˆ–ä¸­ä½æ•°å¡«å……ç©ºå€¼';
                    } else if (dataType === 'datetime') {
                        abnormalDesc = 'å­˜åœ¨æœªæ¥æ—¥æœŸå’Œæ ¼å¼ä¸ç»Ÿä¸€çš„æ—¶é—´å€¼';
                        analysis = 'æ—¥æœŸæ ¼å¼æ··ä¹±ï¼Œéƒ¨åˆ†æ—¥æœŸè¶…å‡ºåˆç†èŒƒå›´';
                        suggestion = 'ç»Ÿä¸€æ—¥æœŸæ ¼å¼ï¼Œç§»é™¤æ— æ•ˆæ—¥æœŸï¼Œæ£€æŸ¥æœªæ¥æ—¥æœŸæ˜¯å¦åˆç†';
                    } else {
                        abnormalDesc = 'å­˜åœ¨ç©ºå€¼ã€ç‰¹æ®Šå­—ç¬¦å’Œæ ¼å¼ä¸ä¸€è‡´é—®é¢˜';
                        analysis = 'æ•°æ®å½•å…¥ä¸è§„èŒƒï¼Œå¯¼è‡´åŒä¸€å­—æ®µæœ‰å¤šç§è¡¨ç°å½¢å¼';
                        suggestion = 'è§„èŒƒåŒ–å­—ç¬¦ä¸²æ ¼å¼ï¼Œç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¹ç©ºå€¼è¿›è¡Œé€‚å½“å¡«å……';
                    }
                    
                    result += `| ${header} | ${abnormalDesc} | ${analysis} | ${suggestion} |\n`;
                }
            } else {
                result += `æ²¡æœ‰å‘ç°æ˜æ˜¾çš„å¼‚å¸¸å€¼ï¼Œæ•°æ®è´¨é‡è‰¯å¥½ã€‚\n`;
            }
            
            // æ•´ä½“æ•°æ®è´¨é‡è¯„ä¼°
            result += `\n## æ•´ä½“æ•°æ®è´¨é‡è¯„ä¼°\n\n`;
            
            // æ ¹æ®å¼‚å¸¸æ•°é‡è¯„ä¼°æ•´ä½“è´¨é‡
            const qualityLevel = abnormalColumns.length > headers.length / 3 ? 'è¾ƒå·®' : 
                               abnormalColumns.length > 0 ? 'ä¸€èˆ¬' : 'è‰¯å¥½';
            
            result += `**æ•°æ®è´¨é‡è¯„çº§**: ${qualityLevel}\n\n`;
            
            // æ·»åŠ æ”¹è¿›å»ºè®®
            result += `### æ•°æ®è´¨é‡æ”¹è¿›å»ºè®®\n\n`;
            result += `1. å»ºç«‹æ•°æ®å½•å…¥è§„èŒƒï¼Œç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´æ€§\n`;
            result += `2. å¯¹ç¼ºå¤±å€¼è¿›è¡Œé€‚å½“å¤„ç†ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©å¡«å……æ–¹å¼\n`;
            result += `3. è®¾ç½®æ•°æ®éªŒè¯è§„åˆ™ï¼Œåœ¨æºå¤´é˜²æ­¢å¼‚å¸¸å€¼çš„äº§ç”Ÿ\n`;
            result += `4. å®šæœŸè¿›è¡Œæ•°æ®è´¨é‡å®¡è®¡ï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜\n`;
            
            // æ•°æ®åˆ†æå»ºè®®
            result += `\n### æ•°æ®åˆ†æå»ºè®®\n\n`;
            result += `1. åœ¨åˆ†æå‰å…ˆè¿›è¡Œæ•°æ®æ¸…æ´—ï¼Œå¤„ç†å·²è¯†åˆ«çš„å¼‚å¸¸å€¼\n`;
            result += `2. è€ƒè™‘ä½¿ç”¨æ•°æ®å¯è§†åŒ–æ–¹æ³•ç›´è§‚åœ°å±•ç¤ºæ•°æ®åˆ†å¸ƒï¼Œè¾…åŠ©å‘ç°é—®é¢˜\n`;
            result += `3. å¯¹é‡è¦æŒ‡æ ‡å»ºç«‹ç›‘æ§æœºåˆ¶ï¼Œè¿½è¸ªæ•°æ®è´¨é‡å˜åŒ–è¶‹åŠ¿\n`;
            result += `4. è¿›è¡Œç›¸å…³æ€§åˆ†æï¼ŒæŒ–æ˜æ•°æ®é—´çš„æ½œåœ¨å…³ç³»\n`;
            
            return result;
        }

        function logProgress(message) {
            progressLog.textContent += message + '\n';
            progressLog.scrollTop = progressLog.scrollHeight;
        }

        function updateProgress(percent) {
            progressFill.style.width = `${percent}%`;
            progressText.textContent = `${Math.round(percent)}%`;
        }

        // å–æ¶ˆåˆ†æ
        document.getElementById('stopBtn')?.addEventListener('click', () => {
            if (analyzing) {
                analyzing = false;
                logProgress('\næ­£åœ¨å–æ¶ˆåˆ†æä»»åŠ¡...');
                if (abortController) {
                    abortController.abort();
                }
            }
        });
    </script>
</body>
</html>